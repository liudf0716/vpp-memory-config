<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPP Startup.conf å†…å­˜é…ç½®å®Œå…¨æŒ‡å—</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            color: #333;
        }

        .presentation {
            width: 100vw;
            height: 100vh;
            position: relative;
        }

        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            display: none;
            padding: 60px 80px;
            background: white;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .slide.active {
            display: flex;
            flex-direction: column;
            justify-content: center;
            opacity: 1;
        }

        .slide-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .slide-title {
            font-size: 3.5em;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .slide-subtitle {
            font-size: 1.8em;
            color: #666;
            font-weight: 300;
        }

        .slide-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-size: 1.3em;
            line-height: 1.8;
        }

        .slide-footer {
            text-align: center;
            padding: 20px 0;
            color: #999;
            font-size: 0.9em;
            border-top: 1px solid #eee;
            margin-top: auto;
        }

        .slide-number {
            position: absolute;
            bottom: 30px;
            right: 40px;
            font-size: 1.2em;
            color: #999;
            font-weight: 600;
        }

        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 25px;
            border-radius: 12px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            margin: 20px 0;
            overflow-x: auto;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .code-comment {
            color: #6a9955;
        }

        .code-keyword {
            color: #569cd6;
        }

        .code-string {
            color: #ce9178;
        }

        .code-number {
            color: #b5cea8;
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 25px;
            border-radius: 12px;
            border-left: 5px solid #667eea;
            margin: 20px 0;
        }

        .warning-box {
            background: #fff3cd;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .error-box {
            background: #f8d7da;
            border-left: 5px solid #dc3545;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .success-box {
            background: #d4edda;
            border-left: 5px solid #28a745;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .two-columns {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin: 20px 0;
        }

        .three-columns {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 30px;
            margin: 20px 0;
        }

        .card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-top: 4px solid #667eea;
        }

        .card h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        ul li {
            padding: 10px 0 10px 30px;
            position: relative;
        }

        ul li:before {
            content: "â–¸";
            position: absolute;
            left: 0;
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        .emphasis {
            color: #667eea;
            font-weight: 600;
        }

        .big-number {
            font-size: 4em;
            font-weight: 700;
            color: #667eea;
            text-align: center;
            margin: 20px 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.95em;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
        }

        td {
            padding: 12px 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background: #f5f5f5;
        }

        .architecture-diagram {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #667eea;
        }

        .memory-block {
            background: white;
            border: 2px solid #667eea;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .memory-block-title {
            font-weight: 700;
            color: #667eea;
            font-size: 1.2em;
            margin-bottom: 8px;
        }

        .memory-block-size {
            color: #28a745;
            font-weight: 600;
        }

        .formula {
            background: #f0f0f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            text-align: center;
            margin: 20px 0;
            border: 2px dashed #667eea;
        }

        .contact-section {
            text-align: center;
            padding: 40px;
        }

        .qr-container {
            display: inline-block;
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.15);
            margin: 20px;
        }

        .qr-placeholder {
            width: 300px;
            height: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5em;
            font-weight: 600;
        }

        .cta-text {
            font-size: 1.8em;
            color: #667eea;
            font-weight: 600;
            margin: 30px 0;
        }

        .navigation-hint {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px 25px;
            border-radius: 20px;
            font-size: 0.9em;
            z-index: 1000;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide.active .slide-content > * {
            animation: fadeInUp 0.6s ease-out;
        }

        .icon {
            font-size: 1.2em;
            margin-right: 8px;
        }

        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    
    <div class="presentation" id="presentation">
        <!-- Slide 1: Title -->
        <div class="slide active">
            <div class="slide-content" style="text-align: center;">
                <h1 class="slide-title" style="font-size: 4.5em; margin-bottom: 30px;">
                    VPP Startup.conf<br>å†…å­˜é…ç½®å®Œå…¨æŒ‡å—
                </h1>
                <p class="slide-subtitle" style="font-size: 2em; margin-bottom: 40px;">
                    æ·±å…¥ç†è§£ VPP å†…å­˜æ¶æ„ä¸æ€§èƒ½ä¼˜åŒ–
                </p>
                <div style="margin-top: 60px;">
                    <p style="font-size: 1.5em; color: #666;">æŠ€æœ¯åˆ†äº«</p>
                    <p style="font-size: 1.2em; color: #999; margin-top: 10px;">2024-12-12</p>
                </div>
            </div>
            <div class="slide-number">1</div>
        </div>

        <!-- Slide 2: ç›®å½• -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">è¯¾ç¨‹å¤§çº²</h2>
            </div>
            <div class="slide-content">
                <div class="three-columns">
                    <div class="card">
                        <h3>ğŸ“‹ åŸºç¡€ç¯‡</h3>
                        <ul>
                            <li>VPP å†…å­˜æ¶æ„æ¦‚è§ˆ</li>
                            <li>å†…å­˜åˆ†ç±»ä¸ç”¨é€”</li>
                            <li>Main Heap è¯¦è§£</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>âš ï¸ æ ¸å¿ƒç¯‡</h3>
                        <ul>
                            <li>Stats Segmentï¼ˆé‡ç‚¹ï¼‰</li>
                            <li>API Segment é…ç½®</li>
                            <li>NUMA ä¼˜åŒ–</li>
                        </ul>
                    </div>
                    <div class="card">
                        <h3>ğŸš€ å®æˆ˜ç¯‡</h3>
                        <ul>
                            <li>çœŸå®æ¡ˆä¾‹åˆ†æ</li>
                            <li>æ€§èƒ½ä¼˜åŒ–å»ºè®®</li>
                            <li>é—®é¢˜æ’æŸ¥æµç¨‹</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="slide-number">2</div>
        </div>

        <!-- Slide 3: VPP å†…å­˜æ¶æ„å…¨æ™¯ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">VPP å†…å­˜æ¶æ„å…¨æ™¯å›¾</h2>
            </div>
            <div class="slide-content">
                <div class="architecture-diagram">
                    <div class="memory-block">
                        <div class="memory-block-title">ğŸ  Main Heap (heapsize)</div>
                        <div>ä¸»çº¿ç¨‹ + Worker çº¿ç¨‹å†…å­˜</div>
                        <div>æ•°æ®åŒ…å¤„ç†ã€è·¯ç”±è¡¨ã€ARP è¡¨</div>
                        <div class="memory-block-size">é»˜è®¤ï¼š1G</div>
                    </div>
                    <div class="memory-block" style="border-color: #dc3545;">
                        <div class="memory-block-title" style="color: #dc3545;">âš ï¸ Stats Segment (statseg)</div>
                        <div>æ¥å£ç»Ÿè®¡è®¡æ•°å™¨</div>
                        <div style="color: #dc3545; font-weight: 600;">âš ï¸ æœ€å¸¸è§ OOM åŸå› ï¼</div>
                        <div class="memory-block-size" style="color: #dc3545;">é»˜è®¤ï¼š32Mï¼ˆå¤ªå°ï¼ï¼‰</div>
                    </div>
                    <div class="memory-block">
                        <div class="memory-block-title">ğŸ“¡ API Segment (api-segment)</div>
                        <div>API æ¶ˆæ¯é˜Ÿåˆ—ã€VPP â†” å®¢æˆ·ç«¯é€šä¿¡</div>
                        <div class="memory-block-size">é»˜è®¤ï¼š64M (global_vm)</div>
                    </div>
                    <div class="memory-block">
                        <div class="memory-block-title">ğŸ”§ Per-NUMA Heaps</div>
                        <div>NUMA æ¶æ„ä¼˜åŒ–ã€æœ¬åœ°å†…å­˜è®¿é—®</div>
                        <div class="memory-block-size">æŒ‰ç³»ç»Ÿé…ç½®</div>
                    </div>
                </div>
            </div>
            <div class="slide-number">3</div>
        </div>

        <!-- Slide 4: å†…å­˜ç±»å‹å¯¹æ¯” -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">å†…å­˜ç±»å‹å¯¹æ¯”</h2>
            </div>
            <div class="slide-content">
                <table>
                    <thead>
                        <tr>
                            <th>å†…å­˜æ®µ</th>
                            <th>é…ç½®å‚æ•°</th>
                            <th>é»˜è®¤å¤§å°</th>
                            <th>ä¸»è¦ç”¨é€”</th>
                            <th>OOM é£é™©</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>Main Heap</strong></td>
                            <td><code>heapsize</code></td>
                            <td>1G</td>
                            <td>æ•°æ®åŒ…å¤„ç†ã€è·¯ç”±è¡¨</td>
                            <td style="color: #28a745;">âœ… ä½</td>
                        </tr>
                        <tr style="background: #fff3cd;">
                            <td><strong>Stats Segment</strong></td>
                            <td><code>statseg { size }</code></td>
                            <td>32M</td>
                            <td>æ¥å£ç»Ÿè®¡</td>
                            <td style="color: #dc3545; font-weight: 700;">âš ï¸ é«˜</td>
                        </tr>
                        <tr>
                            <td><strong>API Segment</strong></td>
                            <td><code>api-segment { global-size }</code></td>
                            <td>64M</td>
                            <td>API é€šä¿¡</td>
                            <td style="color: #ffc107;">âš¡ ä¸­</td>
                        </tr>
                        <tr>
                            <td><strong>NUMA Heaps</strong></td>
                            <td><code>physmem { ... }</code></td>
                            <td>æŒ‰ç³»ç»Ÿ</td>
                            <td>NUMA ä¼˜åŒ–</td>
                            <td style="color: #28a745;">âœ… ä½</td>
                        </tr>
                    </tbody>
                </table>
                <div class="warning-box" style="margin-top: 30px;">
                    <strong>âš ï¸ é‡ç‚¹è®°å¿†ï¼š</strong> Stats Segment æ˜¯æœ€å¸¸è§çš„ OOM åŸå› ï¼é»˜è®¤ 32M åœ¨å¤§è§„æ¨¡éƒ¨ç½²ä¸­ä¸¥é‡ä¸è¶³ã€‚
                </div>
            </div>
            <div class="slide-number">4</div>
        </div>

        <!-- Slide 5: Main Heap è¯¦è§£ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">Main Heap è¯¦è§£</h2>
            </div>
            <div class="slide-content">
                <div class="two-columns">
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">é…ç½®ç¤ºä¾‹</h3>
                        <div class="code-block">
<span class="code-comment"># startup.conf</span>
<span class="code-keyword">heapsize</span> <span class="code-number">3G</span>

<span class="code-comment"># æˆ–æ›´è¯¦ç»†</span>
<span class="code-keyword">heapsize</span> <span class="code-number">3072M</span>
                        </div>
                        <h3 style="color: #667eea; margin: 30px 0 20px;">ç”¨é€”</h3>
                        <ul>
                            <li>æ•°æ®åŒ…ç¼“å†²åŒº</li>
                            <li>FIB/LPM è·¯ç”±è¡¨</li>
                            <li>ARP/ND è¡¨</li>
                            <li>TCP/UDP è¿æ¥è¡¨</li>
                            <li>æ’ä»¶æ•°æ®ç»“æ„</li>
                        </ul>
                    </div>
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">å¤§å°è®¡ç®—å…¬å¼</h3>
                        <div class="formula">
Main Heap = åŸºç¡€å¼€é”€ + æ•°æ®åŒ…ç¼“å†²<br>
+ è·¯ç”±è¡¨ + è¿æ¥çŠ¶æ€ + æ’ä»¶éœ€æ±‚
                        </div>
                        <h3 style="color: #667eea; margin: 30px 0 20px;">æ¨èé…ç½®</h3>
                        <div class="success-box">
                            <strong>è½»é‡çº§è·¯ç”±å™¨ï¼š</strong> 1-2G<br>
                            <strong>ä¸­ç­‰è§„æ¨¡ï¼š</strong> 2-4G<br>
                            <strong>å¤§è§„æ¨¡/é«˜ååï¼š</strong> 4-8G æˆ–æ›´é«˜
                        </div>
                        <h3 style="color: #667eea; margin: 30px 0 20px;">ç›‘æ§å‘½ä»¤</h3>
                        <div class="code-block">
vppctl show memory main-heap
vppctl show threads
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">5</div>
        </div>

        <!-- Slide 6: Stats Segment - ä¸ºä»€ä¹ˆæœ€å®¹æ˜“ OOM -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">âš ï¸ Stats Segmentï¼šæœ€å®¹æ˜“ OOM çš„å†…å­˜æ®µ</h2>
            </div>
            <div class="slide-content">
                <div class="error-box" style="margin-bottom: 30px;">
                    <h3 style="margin-bottom: 15px;">ğŸ”¥ æ ¸å¿ƒé—®é¢˜ï¼šé»˜è®¤å€¼å¤ªå°</h3>
                    <div class="big-number">32MB</div>
                    <p style="text-align: center; font-size: 1.2em;">é»˜è®¤é…ç½®åœ¨å¤§è§„æ¨¡éƒ¨ç½²ä¸­ä¸¥é‡ä¸è¶³ï¼</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>æ¥å£æ•°é‡</th>
                            <th>æ‰€éœ€ç©ºé—´</th>
                            <th>é»˜è®¤ 32M æ˜¯å¦å¤Ÿç”¨</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>100</td>
                            <td>~21M</td>
                            <td style="color: #28a745; font-weight: 600;">âœ… å¤Ÿç”¨</td>
                        </tr>
                        <tr style="background: #fff3cd;">
                            <td>500</td>
                            <td>~105M</td>
                            <td style="color: #dc3545; font-weight: 700;">âŒ ä¸å¤Ÿï¼ˆOOMï¼‰</td>
                        </tr>
                        <tr style="background: #f8d7da;">
                            <td>1000</td>
                            <td>~210M</td>
                            <td style="color: #dc3545; font-weight: 700;">âŒ ä¸¥é‡ä¸è¶³</td>
                        </tr>
                        <tr style="background: #f8d7da;">
                            <td>4000</td>
                            <td>~840M</td>
                            <td style="color: #dc3545; font-weight: 700;">âŒ è¿œè¿œä¸è¶³</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="slide-number">6</div>
        </div>

        <!-- Slide 7: Stats Segment è®¡ç®—å…¬å¼ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">Stats Segment å¤§å°è®¡ç®—</h2>
            </div>
            <div class="slide-content">
                <div class="formula" style="font-size: 1.3em; margin-bottom: 40px;">
æ¯ä¸ªæ¥å£éœ€æ±‚ = 144 å­—èŠ‚ Ã— 1.5ï¼ˆæ‰©å±•é¢„ç•™ï¼‰= 216 å­—èŠ‚
                </div>
                <div class="formula" style="font-size: 1.5em; margin-bottom: 40px;">
Stats Segment = åŸºç¡€å¼€é”€ + (æ¥å£æ•° Ã— 216 å­—èŠ‚ Ã— 2)
                </div>
                <h3 style="color: #667eea; margin: 30px 0 20px; text-align: center;">æ¨èé…ç½®</h3>
                <div class="three-columns">
                    <div class="card">
                        <h3>< 100 æ¥å£</h3>
                        <div class="code-block">
statseg {
  size <span class="code-number">64M</span>
}
                        </div>
                    </div>
                    <div class="card" style="border-top-color: #28a745;">
                        <h3>100-1000 æ¥å£</h3>
                        <div class="code-block">
statseg {
  size <span class="code-number">256M</span>
}
                        </div>
                    </div>
                    <div class="card" style="border-top-color: #ffc107;">
                        <h3>1000-5000 æ¥å£ â­</h3>
                        <div class="code-block">
statseg {
  size <span class="code-number">512M</span>
}
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">7</div>
        </div>

        <!-- Slide 8: çœŸå® OOM æ¡ˆä¾‹ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">çœŸå®æ¡ˆä¾‹ï¼šPPPoE å¤§è§„æ¨¡éƒ¨ç½² OOM</h2>
            </div>
            <div class="slide-content">
                <div class="two-columns">
                    <div>
                        <h3 style="color: #dc3545; margin-bottom: 20px;">ğŸ”´ é—®é¢˜ç°è±¡</h3>
                        <div class="error-box">
                            <strong>åœºæ™¯ï¼š</strong>
                            <ul style="margin-top: 10px;">
                                <li>4000+ PPPoE å®¢æˆ·ç«¯</li>
                                <li>é¢‘ç¹åˆ›å»º/åˆ é™¤ä¼šè¯</li>
                                <li>Main heap: 3G</li>
                                <li>å‡ºç° OOM å´©æºƒ</li>
                            </ul>
                        </div>
                        <h3 style="color: #dc3545; margin: 30px 0 20px;">é”™è¯¯æ—¥å¿—</h3>
                        <div class="code-block">
svm_region_find_or_create:956:
region /stats_vm: not enough VM
to allocate 0x12F4000 (19908304)
os_out_of_memory()
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">ğŸ” é—®é¢˜åˆ†æ</h3>
                        <div class="highlight-box">
                            <ol style="padding-left: 20px;">
                                <li style="margin: 10px 0;">Main heapï¼š3Gï¼Œä½¿ç”¨ç‡ 45% âœ…</li>
                                <li style="margin: 10px 0;">Stats segmentï¼šé»˜è®¤ 32M âŒ</li>
                                <li style="margin: 10px 0;">è®¡ç®—éœ€æ±‚ï¼š
                                    <ul style="margin-top: 10px;">
                                        <li>4450 ä¸ªæ¥å£</li>
                                        <li>Stats vectorï¼š92,168 Ã— 144 å­—èŠ‚ â‰ˆ 13M</li>
                                        <li>åŠ æ‰©å±•é¢„ç•™ï¼š13M Ã— 1.5 â‰ˆ 19M</li>
                                        <li>Stats segment å‰©ä½™ < 19M â†’ OOM</li>
                                    </ul>
                                </li>
                            </ol>
                        </div>
                        <h3 style="color: #28a745; margin: 30px 0 20px;">âœ… è§£å†³æ–¹æ¡ˆ</h3>
                        <div class="success-box">
                            <div class="code-block">
<span class="code-keyword">heapsize</span> <span class="code-number">3G</span>

<span class="code-keyword">statseg</span> {
    <span class="code-keyword">size</span> <span class="code-number">512M</span>  <span class="code-comment"># â† å…³é”®ä¿®æ”¹</span>
}
                            </div>
                            <p style="margin-top: 15px;"><strong>æ•ˆæœï¼š</strong>OOM è§£å†³ï¼Œå¯åˆ›å»º 10,000+ æ¥å£</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">8</div>
        </div>

        <!-- Slide 9: API Segment è¯¦è§£ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">API Segment é…ç½®è¯¦è§£</h2>
            </div>
            <div class="slide-content">
                <div class="two-columns">
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">å‚æ•°å…³ç³»</h3>
                        <div class="highlight-box">
                            <div style="font-family: monospace; font-size: 1.1em;">
â”Œâ”€ global_vm (global-size: 256M) â”€â”<br>
â”‚  â”Œâ”€ API Segment (128M) â”€â”       â”‚<br>
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚<br>
â”‚  â”Œâ”€ Private Heap (64M) â”€â”€â”       â”‚<br>
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚<br>
â”‚  å…¶ä»–å¼€é”€...                       â”‚<br>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            </div>
                        </div>
                        <div class="formula" style="margin-top: 30px;">
global-size â‰¥ api-size + api-pvt-heap-size + å¼€é”€
                        </div>
                        <div class="warning-box" style="margin-top: 20px;">
                            <strong>âš ï¸ å¸¸è§é”™è¯¯ï¼š</strong><br>
                            åªè®¾ç½® api-size è€Œä¸è®¾ç½® global-sizeï¼
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">ä½•æ—¶éœ€è¦è°ƒæ•´ï¼Ÿ</h3>
                        <div class="success-box">
                            <strong>âœ… éœ€è¦å¢åŠ ï¼š</strong>
                            <ul>
                                <li>é«˜é¢‘ API è°ƒç”¨</li>
                                <li>å¤šä¸ªå¹¶å‘å®¢æˆ·ç«¯</li>
                                <li>ring misses > 10%</li>
                                <li>æ‰¹é‡æ“ä½œï¼ˆæ¥å£/è·¯ç”±ï¼‰</li>
                            </ul>
                        </div>
                        <div class="error-box" style="margin-top: 20px;">
                            <strong>âŒ ä¸éœ€è¦å¢åŠ ï¼š</strong>
                            <ul>
                                <li>å¶å°”çš„ CLI å‘½ä»¤</li>
                                <li>å•ä¸€å®¢æˆ·ç«¯ä½¿ç”¨</li>
                                <li>ring misses å¾ˆä½</li>
                            </ul>
                        </div>
                        <h3 style="color: #667eea; margin: 30px 0 20px;">ç›‘æ§å‘½ä»¤</h3>
                        <div class="code-block">
vppctl show api ring-stats
vppctl show api clients
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">9</div>
        </div>

        <!-- Slide 10: NUMA ä¼˜åŒ– -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">NUMA æ¶æ„ä¼˜åŒ–</h2>
            </div>
            <div class="slide-content">
                <div class="two-columns">
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">NUMA æ¶æ„ç¤ºæ„å›¾</h3>
                        <div class="architecture-diagram">
                            <div style="font-family: monospace; font-size: 1.1em; line-height: 1.8;">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€ åŒ NUMA èŠ‚ç‚¹æœåŠ¡å™¨ â”€â”€â”€â”€â”€â”€â”€â”€â”<br>
â”‚  NUMA Node 0      NUMA Node 1    â”‚<br>
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚<br>
â”‚  â”‚ CPU 0-7  â”‚    â”‚ CPU 8-15 â”‚   â”‚<br>
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚<br>
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚<br>
â”‚  â”‚ Memory A â”‚    â”‚ Memory B â”‚   â”‚<br>
â”‚  â”‚ 64GB     â”‚    â”‚ 64GB     â”‚   â”‚<br>
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚<br>
â”‚       â†‘               â†‘          â”‚<br>
â”‚  æœ¬åœ°è®¿é—®å¿«      æœ¬åœ°è®¿é—®å¿«       â”‚<br>
â”‚  è¿œç¨‹è®¿é—®æ…¢      è¿œç¨‹è®¿é—®æ…¢       â”‚<br>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 style="color: #667eea; margin-bottom: 20px;">ä¼˜åŒ–é…ç½®</h3>
                        <div class="code-block">
<span class="code-comment"># CPU é…ç½®</span>
<span class="code-keyword">cpu</span> {
    <span class="code-keyword">main-core</span> <span class="code-number">0</span>
    <span class="code-keyword">corelist-workers</span> <span class="code-number">1-15</span>
    <span class="code-comment"># åªç”¨åŒä¸€ NUMA èŠ‚ç‚¹</span>
}

<span class="code-comment"># å¯ç”¨å¤§é¡µ</span>
<span class="code-keyword">physmem</span> {
    <span class="code-keyword">main-heap-page-size</span> <span class="code-number">2M</span>
}
                        </div>
                        <h3 style="color: #667eea; margin: 30px 0 20px;">ä¸ºä»€ä¹ˆä½¿ç”¨å¤§é¡µï¼Ÿ</h3>
                        <div class="success-box">
                            <strong>æ ‡å‡†é¡µï¼š</strong>4KB<br>
                            <strong>å¤§é¡µï¼š</strong>2MB æˆ– 1GB<br>
                            <hr style="margin: 10px 0;">
                            <strong>ä¼˜åŠ¿ï¼š</strong>
                            <ul>
                                <li>å‡å°‘ TLB miss</li>
                                <li>é™ä½é¡µè¡¨å¼€é”€</li>
                                <li>æå‡ 10-20% æ€§èƒ½</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">10</div>
        </div>

        <!-- Slide 11: æ¨èé…ç½®æ¨¡æ¿ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">æ¨èé…ç½®æ¨¡æ¿</h2>
            </div>
            <div class="slide-content">
                <div class="three-columns">
                    <div class="card">
                        <h3>å°å‹éƒ¨ç½²</h3>
                        <p style="color: #666; margin-bottom: 15px;">< 100 æ¥å£ï¼Œ< 10K è·¯ç”±</p>
                        <div class="code-block" style="font-size: 0.8em;">
<span class="code-keyword">heapsize</span> <span class="code-number">1G</span>

<span class="code-keyword">statseg</span> {
    <span class="code-keyword">size</span> <span class="code-number">128M</span>
}

<span class="code-keyword">cpu</span> {
    <span class="code-keyword">main-core</span> <span class="code-number">0</span>
    <span class="code-keyword">corelist-workers</span> <span class="code-number">1-3</span>
}
                        </div>
                    </div>
                    <div class="card" style="border-top-color: #28a745;">
                        <h3>ä¸­å‹éƒ¨ç½² â­</h3>
                        <p style="color: #666; margin-bottom: 15px;">100-1000 æ¥å£ï¼Œ10K-100K è·¯ç”±</p>
                        <div class="code-block" style="font-size: 0.8em;">
<span class="code-keyword">heapsize</span> <span class="code-number">3G</span>

<span class="code-keyword">statseg</span> {
    <span class="code-keyword">size</span> <span class="code-number">512M</span>
}

<span class="code-keyword">cpu</span> {
    <span class="code-keyword">main-core</span> <span class="code-number">0</span>
    <span class="code-keyword">corelist-workers</span> <span class="code-number">1-7</span>
}

<span class="code-keyword">physmem</span> {
    <span class="code-keyword">main-heap-page-size</span> <span class="code-number">2M</span>
}
                        </div>
                    </div>
                    <div class="card" style="border-top-color: #ffc107;">
                        <h3>å¤§å‹éƒ¨ç½²</h3>
                        <p style="color: #666; margin-bottom: 15px;">> 1000 æ¥å£ï¼Œ> 100K è·¯ç”±</p>
                        <div class="code-block" style="font-size: 0.8em;">
<span class="code-keyword">heapsize</span> <span class="code-number">8G</span>

<span class="code-keyword">statseg</span> {
    <span class="code-keyword">size</span> <span class="code-number">1G</span>
}

<span class="code-keyword">api-segment</span> {
    <span class="code-keyword">global-size</span> <span class="code-number">512M</span>
}

<span class="code-keyword">cpu</span> {
    <span class="code-keyword">main-core</span> <span class="code-number">0</span>
    <span class="code-keyword">corelist-workers</span> <span class="code-number">1-15</span>
}
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">11</div>
        </div>

        <!-- Slide 12: æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆçº§ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">æ€§èƒ½ä¼˜åŒ–ä¼˜å…ˆçº§</h2>
            </div>
            <div class="slide-content">
                <div class="highlight-box" style="background: linear-gradient(135deg, #dc354515 0%, #dc354515 100%); border-left-color: #dc3545;">
                    <h3 style="color: #dc3545; margin-bottom: 20px;">â­â­â­ é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»åšï¼‰</h3>
                    <ul style="font-size: 1.2em;">
                        <li><strong>Stats Segment</strong> æ ¹æ®æ¥å£æ•°é‡è°ƒæ•´</li>
                        <li><strong>Main Heap</strong> æ ¹æ®è·¯ç”±è¡¨è§„æ¨¡è°ƒæ•´</li>
                        <li><strong>å¯ç”¨ Huge Pages</strong></li>
                    </ul>
                </div>
                <div class="highlight-box" style="background: linear-gradient(135deg, #ffc10715 0%, #ffc10715 100%); border-left-color: #ffc107; margin-top: 30px;">
                    <h3 style="color: #ffc107; margin-bottom: 20px;">â­â­ ä¸­ä¼˜å…ˆçº§ï¼ˆæ¨èåšï¼‰</h3>
                    <ul style="font-size: 1.2em;">
                        <li><strong>NUMA äº²å’Œæ€§</strong>é…ç½®</li>
                        <li><strong>API Segment</strong>ï¼ˆé«˜é¢‘ API åœºæ™¯ï¼‰</li>
                    </ul>
                </div>
                <div class="highlight-box" style="margin-top: 30px;">
                    <h3 style="color: #667eea; margin-bottom: 20px;">â­ ä½ä¼˜å…ˆçº§ï¼ˆå¯é€‰ï¼‰</h3>
                    <ul style="font-size: 1.2em;">
                        <li>Fine-tune worker çº¿ç¨‹æ•°</li>
                        <li>è°ƒæ•´ buffer æ± å¤§å°</li>
                    </ul>
                </div>
            </div>
            <div class="slide-number">12</div>
        </div>

        <!-- Slide 13: OOM é—®é¢˜æ’æŸ¥æµç¨‹ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">OOM é—®é¢˜æ’æŸ¥æµç¨‹</h2>
            </div>
            <div class="slide-content">
                <div class="architecture-diagram">
                    <div style="font-family: monospace; font-size: 1.15em; line-height: 2;">
<strong style="color: #dc3545;">VPP OOM å´©æºƒ</strong><br>
    â”‚<br>
    â”œâ”€â†’ <strong>1. æ£€æŸ¥æ—¥å¿—ï¼Œæ‰¾åˆ°é”™è¯¯ä¿¡æ¯</strong><br>
    â”‚   â€¢ "region /global_vm" â†’ API Segment é—®é¢˜<br>
    â”‚   â€¢ "stats_vm" â†’ Stats Segment é—®é¢˜<br>
    â”‚   â€¢ å…¶ä»– â†’ Main Heap é—®é¢˜<br>
    â”‚<br>
    â”œâ”€â†’ <strong>2. æŸ¥çœ‹å½“å‰å†…å­˜ä½¿ç”¨</strong><br>
    â”‚   vppctl show memory [segment]<br>
    â”‚<br>
    â”œâ”€â†’ <strong>3. è®¡ç®—å®é™…éœ€æ±‚</strong><br>
    â”‚   â€¢ æ¥å£æ•°é‡ Ã— 216 å­—èŠ‚ (stats)<br>
    â”‚   â€¢ è·¯ç”±æ•°é‡ Ã— 256 å­—èŠ‚ (main)<br>
    â”‚   â€¢ API è°ƒç”¨é¢‘ç‡ (api)<br>
    â”‚<br>
    â””â”€â†’ <strong>4. è°ƒæ•´é…ç½®å¹¶é‡å¯</strong><br>
        ä¿®æ”¹ startup.conf â†’ é‡å¯ VPP
                    </div>
                </div>
            </div>
            <div class="slide-number">13</div>
        </div>

        <!-- Slide 14: å¸¸ç”¨è¯Šæ–­å‘½ä»¤ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">å¸¸ç”¨è¯Šæ–­å‘½ä»¤é€ŸæŸ¥</h2>
            </div>
            <div class="slide-content">
                <table>
                    <thead>
                        <tr>
                            <th>é—®é¢˜ç±»å‹</th>
                            <th>è¯Šæ–­å‘½ä»¤</th>
                            <th>å…³é”®æŒ‡æ ‡</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>å†…å­˜ä¸è¶³</strong></td>
                            <td><code>show memory main-heap</code></td>
                            <td>used / total > 80%</td>
                        </tr>
                        <tr>
                            <td><strong>Stats OOM</strong></td>
                            <td><code>show memory stats-segment</code></td>
                            <td>used / total > 90%</td>
                        </tr>
                        <tr>
                            <td><strong>API æ…¢</strong></td>
                            <td><code>show api ring-stats</code></td>
                            <td>ring misses > 10%</td>
                        </tr>
                        <tr>
                            <td><strong>NUMA é—®é¢˜</strong></td>
                            <td><code>show memory numa-heaps</code></td>
                            <td>è·¨èŠ‚ç‚¹è®¿é—®</td>
                        </tr>
                        <tr>
                            <td><strong>æ¥å£ç»Ÿè®¡</strong></td>
                            <td><code>show interface</code></td>
                            <td>æ¥å£æ•°é‡</td>
                        </tr>
                        <tr>
                            <td><strong>å¤§é¡µä½¿ç”¨</strong></td>
                            <td><code>cat /proc/meminfo | grep Huge</code></td>
                            <td>HugePages_Free</td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="slide-number">14</div>
        </div>

        <!-- Slide 15: å…³é”®è¦ç‚¹æ€»ç»“ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">å…³é”®è¦ç‚¹æ€»ç»“</h2>
            </div>
            <div class="slide-content">
                <div class="two-columns">
                    <div>
                        <div class="error-box">
                            <h3 style="margin-bottom: 15px;">ğŸ”¥ æœ€é‡è¦ï¼šStats Segment</h3>
                            <ul style="font-size: 1.1em;">
                                <li>é»˜è®¤ 32M å¤ªå°</li>
                                <li>æœ€å¸¸è§çš„ OOM åŸå› </li>
                                <li>å»ºè®®è‡³å°‘ 256M</li>
                                <li>å¤§è§„æ¨¡éƒ¨ç½²ç”¨ 512M-1G</li>
                            </ul>
                        </div>
                        <div class="success-box" style="margin-top: 30px;">
                            <h3 style="margin-bottom: 15px;">âœ… Main Heap æ ¹æ®åœºæ™¯è°ƒæ•´</h3>
                            <ul style="font-size: 1.1em;">
                                <li>å°å‹ï¼š1-2G</li>
                                <li>ä¸­å‹ï¼š2-4G</li>
                                <li>å¤§å‹ï¼š4-8G</li>
                            </ul>
                        </div>
                    </div>
                    <div>
                        <div class="highlight-box">
                            <h3 style="margin-bottom: 15px;">ğŸ”§ API Segment æŒ‰éœ€é…ç½®</h3>
                            <ul style="font-size: 1.1em;">
                                <li>ä½é¢‘ä½¿ç”¨ï¼šé»˜è®¤å³å¯</li>
                                <li>é«˜é¢‘ APIï¼š256M-512M</li>
                                <li>æ³¨æ„ global-size å¿…é¡»å¤§äº api-size</li>
                            </ul>
                        </div>
                        <div class="warning-box" style="margin-top: 30px;">
                            <h3 style="margin-bottom: 15px;">âš¡ NUMA ä¼˜åŒ–å¾ˆé‡è¦</h3>
                            <ul style="font-size: 1.1em;">
                                <li>é¿å…è·¨èŠ‚ç‚¹è®¿é—®</li>
                                <li>å¯ç”¨å¤§é¡µï¼ˆ2M page sizeï¼‰</li>
                                <li>æ€§èƒ½æå‡ 10-20%</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="slide-number">15</div>
        </div>

        <!-- Slide 16: è”ç³»æ–¹å¼ -->
        <div class="slide">
            <div class="slide-header">
                <h2 class="slide-title">æ„Ÿè°¢è§‚çœ‹ï¼</h2>
            </div>
            <div class="slide-content contact-section">
                <div class="cta-text">
                    ğŸ¯ æ¬¢è¿åŠ å…¥æŠ€æœ¯äº¤æµç¾¤ï¼Œä¸€èµ·æ¢è®¨ VPP æŠ€æœ¯ï¼
                </div>
                <div style="display: flex; align-items: center; justify-content: center; gap: 60px; margin: 40px 0;">
                    <div class="qr-container">
                        <img src="qq-group.jpg" alt="QQ ç¾¤äºŒç»´ç " style="max-width: 450px; max-height: 500px; width: auto; height: auto; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);">
                    </div>
                    <div style="text-align: left; font-size: 1.4em; color: #666; max-width: 500px;">
                        <p style="margin-bottom: 25px;">ğŸ’¬ <strong>æ‰«ç åŠ ç¾¤</strong>ï¼Œä¸ä¸“å®¶å’ŒåŒè¡Œäº¤æµ</p>
                        <p style="margin-bottom: 25px;">ğŸš€ <strong>åˆ†äº«ç»éªŒ</strong>ï¼Œå…±åŒæˆé•¿</p>
                        <p style="margin-bottom: 25px;">ğŸ“š <strong>è·å–èµ„æ–™</strong>ï¼Œæ›´å¤šæŠ€æœ¯æ–‡æ¡£å’Œèµ„æ–™</p>
                        <p style="margin-bottom: 25px;">ğŸ¯ <strong>æŠ€æœ¯æ”¯æŒ</strong>ï¼ŒVPP é—®é¢˜ç­”ç–‘è§£æƒ‘</p>
                        <p style="margin-bottom: 25px;">ğŸ’¡ <strong>å®æˆ˜æ¡ˆä¾‹</strong>ï¼Œç”Ÿäº§ç¯å¢ƒç»éªŒåˆ†äº«</p>
                    </div>
                </div>
                <div style="margin-top: 40px; font-size: 1em; color: #999;">
                    <p>Â© 2024 VPP æŠ€æœ¯åˆ†äº« | ä¿ç•™æ‰€æœ‰æƒåˆ©</p>
                </div>
            </div>
            <div class="slide-number">16</div>
        </div>
    </div>

    <div class="navigation-hint">
        â† â†’ é”®åˆ‡æ¢å¹»ç¯ç‰‡ | ESC é€€å‡ºå…¨å±
    </div>

    <script>
        // Slide navigation
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const totalSlides = slides.length;
        const progressBar = document.getElementById('progressBar');

        function showSlide(index) {
            slides.forEach(slide => slide.classList.remove('active'));
            slides[index].classList.add('active');
            currentSlide = index;
            updateProgress();
        }

        function updateProgress() {
            const progress = ((currentSlide + 1) / totalSlides) * 100;
            progressBar.style.width = progress + '%';
        }

        function nextSlide() {
            if (currentSlide < totalSlides - 1) {
                showSlide(currentSlide + 1);
            }
        }

        function prevSlide() {
            if (currentSlide > 0) {
                showSlide(currentSlide - 1);
            }
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'Enter') {
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                prevSlide();
            } else if (e.key === 'Home') {
                showSlide(0);
            } else if (e.key === 'End') {
                showSlide(totalSlides - 1);
            } else if (e.key === 'Escape') {
                if (document.fullscreenElement) {
                    document.exitFullscreen();
                }
            }
        });

        // Click navigation (click on sides)
        document.addEventListener('click', (e) => {
            const clickX = e.clientX;
            const windowWidth = window.innerWidth;
            
            if (clickX < windowWidth * 0.3) {
                prevSlide();
            } else if (clickX > windowWidth * 0.7) {
                nextSlide();
            }
        });

        // Touch navigation for mobile
        let touchStartX = 0;
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.touches[0].clientX;
        });

        document.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const diff = touchStartX - touchEndX;
            
            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    nextSlide();
                } else {
                    prevSlide();
                }
            }
        });

        // Initialize
        updateProgress();

        // Add fullscreen functionality
        document.addEventListener('dblclick', () => {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });
    </script>
</body>
</html>
